<!DOCTYPE html>
<html>
<head>
  <title>ROS Connection Test</title>
  <script src="node_modules/openmct/dist/openmct.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/roslib@1.3.0/build/roslib.min.js"></script>
  <script src="actions/combo-start-plugin.js"></script>
  <script src="plugins/camera/camera_plugin.js"></script>
  <!-- <script src="plugins/camera/WebcamPlugin.js"></script> -->
  <script src="plugins/display/CostmapPlugin.js"></script>
  <script src="plugins/display/ThemeTogglePlugin.js"></script> 
  <script src="plugins/ZED/ZEDPlugin.js"></script>

  <script src="plugins/mission-control/MissionControlView.js"></script>
  <script src="plugins/mission-control/RoverStatusView.js"></script>
  <script src="plugins/mission-control/plugin.js"></script>

  <script src="plugins/Arm-Control/ArmControlView.js"></script>
  <script src="plugins/Arm-Control/plugin.js"></script>

  <script src="plugins/Drilling-Control/DrillingControlView.js"></script>
  <script src="plugins/Drilling-Control/plugin.js"></script>

  <script src="plugins/joystick-control/plugin.js"></script>
  <script src="plugins/joystick-control/JoystickView.js"></script>

  <link rel="stylesheet" href="plugins/Arm-Control/ArmControlView.css">
  <link rel="stylesheet" href="plugins/joystick-control/JoystickView.css">
  <link rel="stylesheet" href="plugins/Drilling-Control/DrillingControlView.css">

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      openmct.setAssetPath('/node_modules/openmct/dist/');
      openmct.install(openmct.plugins.LocalStorage());
      openmct.install(openmct.plugins.MyItems());
      openmct.install(openmct.plugins.UTCTimeSystem());
      openmct.install(openmct.plugins.Notebook());
      openmct.install(openmct.plugins.Timer());
      openmct.install(openmct.plugins.LADTable());
      openmct.install(openmct.plugins.ObjectMigration());
      openmct.install(
        openmct.plugins.ClearData(
          ['table', 'telemetry.plot.overlay', 'telemetry.plot.stacked', 'example.imagery'],
          { indicator: true }
        )
      );
      openmct.install(openmct.plugins.SummaryWidget());
      openmct.install(
        openmct.plugins.DisplayLayout({
          showAsView: ['summary-widget', 'example.imagery','costmap-map']
        })
      );

      const savedTheme = localStorage.getItem('openmct.theme') || 'snow';
      if (savedTheme === 'snow') {
          openmct.install(openmct.plugins.Snow());
          console.log('Open MCT started with Snow theme (light mode).');
      } else {
          openmct.install(openmct.plugins.Espresso());
          console.log('Open MCT started with Espresso theme (dark mode).');
      }
      openmct.time.clock('local', {start: -15 * 60 * 1000, end: 0});
      openmct.time.setMode('realtime');
      openmct.time.timeSystem('utc');

      // Install all custom plugins
      openmct.install(window.StartComboPlugin());
      openmct.install(window.CostmapMapPlugin({
          defaultCostmapSourceUrl: 'http://localhost:8080/images/new_yard.png',
          defaultPixelOffsetX: 70,
          defaultPixelOffsetY: 246,
          defaultPixelsPerMeter: 20,
          checkpointsData: [[15.1159, -3.0854], [6.8073, 10.3746], [25.2349, 2.0235], [17.9612, 2.8924]],
          landmarksData: [],
          finalGoalData: [18.6625, 10.8159]
      }));
      openmct.install(window.CameraPlugin());
      openmct.install(window.ZEDPlugin());
      // openmct.install(window.WebcamPlugin());
      openmct.install(window.DrillingControlPlugin());
      openmct.install(window.JoystickPlugin());
      openmct.install(window.MissionControlPlugin());
      openmct.install(window.ArmControlPlugin());
      openmct.install(window.ThemeToggleObjectPlugin());
      
      openmct.start();
	function captureZEDScreenshot() {
        const zedCanvas = document.querySelector('canvas'); // adjust if needed
        if (!zedCanvas) {
            alert('ZED feed not found!');
            return;
        }

        const dataURL = zedCanvas.toDataURL('image/png');

        const link = document.createElement('a');
        link.href = dataURL;
        link.download = `zed_screenshot_${Date.now()}.png`;
        link.click();
    }

    // --- Button for screenshots ---
    const button = document.createElement('button');
    button.innerText = 'Take ZED Screenshot';
    button.style.position = 'fixed';
    button.style.top = '10px';
    button.style.right = '10px';
    button.style.zIndex = '9999';
    button.style.padding = '8px 12px';
    button.style.backgroundColor = '#007BFF';
    button.style.color = '#fff';
    button.style.border = 'none';
    button.style.borderRadius = '4px';
    button.style.cursor = 'pointer';
    button.onclick = captureZEDScreenshot;

    document.body.appendChild(button);
    });

  </script>
  <style>
  </style>
</head>
<body>
</body>
</html>
